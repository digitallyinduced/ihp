#!/usr/bin/env php
<?php
if ($argc < 2) {
    echo "Usage: gen/controller RESOURCE_NAME\n";
    exit(1);
}
$basePath = realpath(__DIR__ . "../../..");

$controller = ucfirst($argv[1]);

$controllerPath = ltrim("$basePath/src/Controller/$controller.hs", '/');
if (file_exists($controllerPath)) {
    echo "Controller already exists: $controllerPath\n";
    exit(1);
}
$model = substr($controller, 0,-1);

ob_start();
?>
module Controller.<?= $controller ?> where

import Foundation.ControllerPrelude
import Model.<?= $model ?> (<?= $model ?>)
import qualified Model.<?= $model ?> as <?= $model ?>


index :: Action
index = do
    renderPlain "<?= $controller ?> Index Action"

new :: Action
new = do
    renderPlain "<?= $controller ?> New Action"

show :: Int -> Action
show id = do
    renderPlain "<?= $controller ?> Show Action"

edit :: Int -> Action
edit id = do
    renderPlain "<?= $controller ?> Edit Action"

create :: Action
create = do
    renderPlain "<?= $controller ?> Create Action"
<?php
$body = ob_get_clean();

file_put_contents($controllerPath, $body);
echo "+ $controllerPath\n";
