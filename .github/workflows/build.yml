name: Linux Build
on:
  push:
    branches: [issue-314/fix-test-builds]

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: cachix/install-nix-action@v9
    - uses: cachix/cachix-action@v6
      with:
        name: digitallyinduced
        signingKey: '${{ secrets.CACHIX_SIGNING_KEY }}'
        authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'

    - run: |
          git clone https://github.com/digitallyinduced/ihp-boilerplate.git
          cd ihp-boilerplate
          echo "<?php" >> replace.php
          echo "\$file_contents = file_get_contents('./ihp-boilerplate/default.nix');" >> replace.php
          echo '$new_content = preg_replace("/\".{40}\"/", $argv[1], $file_contents);' >> replace.php
          echo "file_put_contents('./ihp-boilerplate/default.nix', $new_content);" >> replace.php
          echo "?>" >> replace.php
          php replace.php "\"$GITHUB_SHA\""
          nix-shell --run "echo 'It worked'"
          

